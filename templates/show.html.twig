{% extends 'layouts/base.html.twig' %}

{% block title %}
SnowTricks
{% endblock %}

{% block body %}
    <header class="mb-auto container mt-3">
        <div class=" justify-content-center text-bg-dark header-trick" style='background-image: url("{{ asset('/uploads/'~trick.image) }}" );'>
            <div class="d-flex justify-content-end">
                <div class="col-md-1 mt-2 bg-white text-center p-2">
                        {% if app.user %}
                            <div>
                                <small class="p-3 icon"><a href="{{ path('edit',{'id':trick.id}) }}" ><i class="fa-solid fa-pencil"></i></a></small>
                                <small class="p-1 icon"><a href="#" class="link"><i class="fa-solid fa-trash"></i></a></small>
                            </div>
                        {% endif %}
                    </div>
            </div>
            <div class="row rounded text-center mt-5">
                <div class="col-md-12 mt-5">
                    <h1 class="display-4 text-white">{{ trick.name }}</h1>
                </div>
            </div>
        </div>
    </header>
    
	<main class="container">
        <div class="container px-4 py-5" id="custom-cards">
            <div class="row" id="images">
                {% for image in trick.images %}
                    <div class="col-3 p-2">
                        <div class="card card-cover overflow-hidden text-bg-dark rounded-4 shadow-lg" style='background-image: url("{{ asset('/uploads/'~image.url) }}" );'>
                            <div class="d-flex justify-content-end flex-column p-2 pb-3 text-white text-shadow-1"></div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="row py-5">
                <div class="col-12">
                    <p>{{ trick.content }}</p>
                </div>
            </div>  
  
            <div class="row">
                <div class="bd-example-snippet bd-code-snippet">
                    <div class="bd-example">
                        <span class="badge rounded-pill bg-dark">{{ trick.category.name }}</span>
                        <span class="badge rounded-pill bg-dark">{{ trick.createdAt|date('d-m-Y') }}</span>
                    </div>
                </div>
            </div>
            {{ form_start(CommentFormType) }}
                {{ form_row(CommentFormType.content) }}
                <button type="submit" class="btn btn-lg btn-primary btn-block mt-4">Save</button>
            {{ form_end(CommentFormType) }}
            <div id="comments">
                {% include 'comments/list.html.twig' %}
            </div>
            <div class="row text-center">
                <button onClick="loadMore()" class="btn btn-dark" id="loadMore">Load More</button>
            </div>
        </div>	
	</main>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script> 
<script type="text/javascript" >

function loadMore() {
   
	$.ajax({
		url: "{{ path('load_comments', {'id': trick.id}) }}",
		type: "GET",
		contentType: "html",
        success: function(response) {
            var htmlToDisplay = response.trim();
            $("#comments").append(response);
        },
        error: function(errorThrown){
            console.log(errorThrown);
        }
	})
}
</script>
{% endblock %}